<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Modelos termodinámicos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<meta name="shinylive:serviceworker_dir" content=".">
<script src="site_libs/quarto-contrib/shinylive-0.7.0/shinylive/load-shinylive-sw.js" type="module"></script>
<script src="site_libs/quarto-contrib/shinylive-0.7.0/shinylive/run-python-blocks.js" type="module"></script>
<link href="site_libs/quarto-contrib/shinylive-0.7.0/shinylive/shinylive.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/shinylive-quarto-css/shinylive-quarto.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./mc_eos.html">Modelos termodinámicos</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">IIQ2043</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Inicio</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">Tópicos</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mc_eos.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Modelos termodinámicos</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mc_fug.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fugacidad</span></a>
  </div>
</li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>Material complementario</p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Contenido</h2>
   
  <ul>
  <li><a href="#motivación-primera-ley-de-la-termodinámica" id="toc-motivación-primera-ley-de-la-termodinámica" class="nav-link active" data-scroll-target="#motivación-primera-ley-de-la-termodinámica">Motivación: Primera ley de la termodinámica</a></li>
  <li><a href="#propiedades-de-los-compuestos-puros" id="toc-propiedades-de-los-compuestos-puros" class="nav-link" data-scroll-target="#propiedades-de-los-compuestos-puros">Propiedades de los compuestos puros</a></li>
  <li><a href="#ecuaciones-de-estado-eos" id="toc-ecuaciones-de-estado-eos" class="nav-link" data-scroll-target="#ecuaciones-de-estado-eos">Ecuaciones de estado (EoS)</a>
  <ul class="collapse">
  <li><a href="#términos-asociados-a-los-principios-de-lennard-jones" id="toc-términos-asociados-a-los-principios-de-lennard-jones" class="nav-link" data-scroll-target="#términos-asociados-a-los-principios-de-lennard-jones">Términos asociados a los principios de Lennard-Jones</a></li>
  <li><a href="#otros-términos" id="toc-otros-términos" class="nav-link" data-scroll-target="#otros-términos">Otros términos</a></li>
  </ul></li>
  <li><a href="#ejemplo-diagrama-pv-para-co_2" id="toc-ejemplo-diagrama-pv-para-co_2" class="nav-link" data-scroll-target="#ejemplo-diagrama-pv-para-co_2">Ejemplo: Diagrama PV para CO<span class="math inline">\(_2\)</span></a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/IIQ2043/workbook/blob/main/mc_eos.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Modelos termodinámicos</h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Importante
</div>
</div>
<div class="callout-body-container callout-body">
<p>En esta sección se espera que el alumno maneje conceptos tales como: Diagramas <em>P-V-T</em>; propiedades críticas; gas ideal; conocimientos básicos sobre la entalpía y entropía. En caso de querer reforzar algún concepto mencionado, se recomienda leer la sección 2.2 del libro <a href="https://bmdigitales-bibliotecas-uc-cl.pucdechile.idm.oclc.org/html5/FUNDAMENTALS%20OF%20CHEMICAL%20ENGINEERING%20THERMODYNAMICS%20K.%20D.%20DAHM/">Fundamentals of Chemical Engineering Thermodynamics</a> (páginas 49-57).</p>
</div>
</div>
<section id="motivación-primera-ley-de-la-termodinámica" class="level2">
<h2 class="anchored" data-anchor-id="motivación-primera-ley-de-la-termodinámica">Motivación: Primera ley de la termodinámica</h2>
<p>Los fluidos, al estar compuestos de moléculas, tienen una energía intrínseca que les pertenece: la energía interna. En los sistema que estudiamos suele ser importante entender cómo la energía interna se transforma en otras formas de energía (calor, trabajo, energía cinética, entre otras). Ya que la relación entre ellas depende del sistema que estemos evaluando, utilizamos balances de energía para comprender lo que ocurre en un equipo o una planta química completa.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout="[0.65, 0.35]">
<div class="quarto-layout-row">
<div id="firstcol" class="quarto-layout-cell" style="flex-basis: 65.0%;justify-content: flex-start;">
<p>La ecuación generalizada, <span class="math display">\[
d\left(U + \frac{Mv^2}{2} + Mgh\right) = \delta W + \delta Q + \sum_{in} \delta m_{in}\left( \hat{H}_{in} + \frac{v^2_{in}}{2} + gh_{in} \right)
\]</span> <span class="math display">\[
- \sum_{out} \delta m_{out}\left( \hat{H}_{out} + \frac{v^2_{out}}{2} + gh_{out} \right)
\]</span></p>
<p>puede parecer compleja o tediosa de calcular. En este caso se considera un <strong>sistema abierto</strong>, el cuál se somete a cambios de energía producidos en presencia de trabajo de eje; calor; energía interna, potencial y cinética; entrada y salida de energía, expansión y compresión. En la práctica, los sistemas presentan solo algunos de los factores considerados en la ecuación generalizada.</p>
</div>
<div id="secondcol" class="quarto-layout-cell" style="flex-basis: 35.0%;justify-content: flex-start;">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Parámetros y variables
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><span class="math inline">\(U\)</span>: Energía interna (<span class="math inline">\(\text{J}\)</span>)</li>
<li><span class="math inline">\(M\)</span>: Masa total en el sistema (<span class="math inline">\(\text{kg}\)</span>)</li>
<li><span class="math inline">\(v\)</span>: Velocidad (<span class="math inline">\(\text{m}\cdot\text{s}^{-1}\)</span>)</li>
<li><span class="math inline">\(h\)</span>: Altura (<span class="math inline">\(\text{m}\)</span>)</li>
<li><span class="math inline">\(\hat{H}\)</span>: Entalpía específica (<span class="math inline">\(\text{J}\cdot\text{kg}^{-1}\)</span>)</li>
<li><span class="math inline">\(\delta m_{in}\)</span> o <span class="math inline">\(\delta m_{out}\)</span>: Masa que entra o sale del sistema (<span class="math inline">\(\text{kg}\)</span>)</li>
<li><span class="math inline">\(W\)</span>: Trabajo que entra al sistema. Puede ser de eje, expansión y/o compresión (<span class="math inline">\(\text{J}\)</span>)</li>
<li><span class="math inline">\(Q\)</span>: Calor que entra al sistema (<span class="math inline">\(\text{J}\)</span>)</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Otra forma de encontrar esta ecuación es en su forma <strong>transiente</strong>, en otras palabras, considerando la variación en el tiempo.</p>
<p><span class="math display">\[
\frac{d}{dt}\left[M\left(\hat{U} + \frac{v^2}{2} + gh\right)\right] = \dot{W} + \dot{Q} + \sum_{in} \dot{m}_{in}\left( \hat{H}_{in} + \frac{v^2_{in}}{2} + gh_{in} \right) - \sum_{out} \dot{m}_{out}\left( \hat{H}_{out} + \frac{v^2_{out}}{2} + gh_{out} \right)
\]</span></p>
<p>Sin embargo, en la mayoría de libros y cursos de termodinámica se presenta el balance de energía para sistemas <strong>no transientes y cerrados</strong> bajo el nombre de la primera ley de la termodinámica.</p>
<p><span class="math display">\[
\delta U = \delta W + \delta Q
\]</span></p>
<p>Independientemente de nuestro sistema, ya sea una bomba, una turbina, una válvula o una caldera, el balance de energía tiene un rol fundamental en definir el comportamiento de este.</p>
<p>El siguiente paso para evaluar nuestro sistema sería cuantificar los cambios energéticos. Esto se consigue <strong>midiendo</strong> las variaciones de energía. Aquí que surge un problema: no es posible medir la energía interna <span class="math inline">\(U\)</span>. Esto último no se puede hacer de forma directa, y en consecuencia, existe una necesidad de definir las propiedades termodinámicas en función de <strong>unidades medibles</strong>: presión (<span class="math inline">\(P\)</span>), volumen (<span class="math inline">\(V\)</span>) y temperatura (<span class="math inline">\(T\)</span>).</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sobre la notación
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>En esta página se utilizará la siguiente notación.</p>
<p>Volúmen: <span class="math inline">\(V~\text{(m}^3\text{)}\)</span></p>
<p>Volúmen másico: <span class="math inline">\(\hat{V}~\text{(m}^3\cdot\text{kg}^{-1}\text{)}\)</span></p>
<p>Volúmen molar: <span class="math inline">\(\underline{V}~\text{(m}^3\cdot\text{mol}^{-1}\text{)}\)</span></p>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="propiedades-de-los-compuestos-puros" class="level2">
<h2 class="anchored" data-anchor-id="propiedades-de-los-compuestos-puros">Propiedades de los compuestos puros</h2>
<p>Antes de continuar, es importante hacer un paréntesis con respecto a las <strong>propiedades de estado</strong>. Estas son aquellas características de la condición en la que se encuentra un compuesto o sistema. Sin importar el cómo se llego a esa condición, las propiedades de estado siempre serán las mismas. Eso significa que la energía interna del agua a <span class="math inline">\(25~^\circ\text{C}\)</span> y <span class="math inline">\(1\)</span> atmósfera será siempre la misma idependientemente de la manera en que se llegó a la condición, siempre y cuando los sistemas sean iguales.</p>
<p>Existen propiedades de estado que son de suma importancia para el estudio de la termodinámica. Las ecuaciones que las describen se denominan <strong>ecuaciones fundamentales de la termodinámica</strong> y entre ellas se encuentra la energía interna.</p>
<table class="table-hover table">
<caption>Tabla: Ecuaciones fundamentales</caption>
<thead>
<tr class="header">
<th>Propiedad</th>
<th>Ecuación</th>
<th>Variables naturales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Energía interna</td>
<td><span class="math inline">\(dU = TdS-PdV\)</span></td>
<td><span class="math inline">\(U(S,~V)\)</span></td>
</tr>
<tr class="even">
<td>Energía de Helmholtz</td>
<td><span class="math inline">\(dA = SdT-PdV\)</span></td>
<td><span class="math inline">\(A(T,~V)\)</span></td>
</tr>
<tr class="odd">
<td>Entalpía</td>
<td><span class="math inline">\(dH = TdS+VdP\)</span></td>
<td><span class="math inline">\(H(S,~P)\)</span></td>
</tr>
<tr class="even">
<td>Energía libre de Gibbs</td>
<td><span class="math inline">\(dG = -SdT+VdP\)</span></td>
<td><span class="math inline">\(G(T,~P)\)</span></td>
</tr>
</tbody>
</table>
<p>A partir de estas ecuaciones, las relaciones de Maxwell y las herramientas de cálculo que se aprenden en el curso, es posible describir los cambios en las propiedades de un estado a otro (para compuestos puros). De esta manera, podemos cumplir con nuestro objetivo de <strong>relacionar la energía con propiedades medibles</strong>. Pongamos a prueba esto a través de un ejercicio.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ejercicio
</div>
</div>
<div class="callout-body-container callout-body">
<p>Es común suponer que la entalpía de un fluido que entra a una válvula es la misma que posee al salir de esta (isoentalpía); se desea relacionar la entalpía con unidades medibles. Demuestre a partir de la expresión:</p>
<p><span class="math display">\[
dH = \left(\frac{\partial H}{\partial T}\right)_PdT + \left(\frac{\partial H}{\partial P}\right)_TdP
\]</span></p>
<p>Que se puede llegar a la siguiente ecuación que relaciona la entalpía con la presión, temperatura y volumen.</p>
<p><span class="math display">\[
dH = c_PdT + \left[ V - T\left(\frac{\partial V}{\partial T}\right)_P\right]dP
\]</span></p>
</div>
</div>
<p>Fijémonos en la solución del ejercicio anterior. A pesar de que la entalpía quedó expresada únicamente en función de <span class="math inline">\(P\)</span>, <span class="math inline">\(V\)</span> y <span class="math inline">\(T\)</span>, ¿cómo podríamos calcular <span class="math inline">\(\left(\partial V/\partial T\right)_P\)</span>? Aún necesitamos encontrar alguna función que relacione estas propiedades entre sí. Para esto tenemos las <strong>ecuaciones de estado</strong>.</p>
<p><br></p>
</section>
<section id="ecuaciones-de-estado-eos" class="level2">
<h2 class="anchored" data-anchor-id="ecuaciones-de-estado-eos">Ecuaciones de estado (EoS)</h2>
<p>Las ecuaciones de estado relacionan las propiedades de presión (<span class="math inline">\(P\)</span>), volúmen (<span class="math inline">\(V\)</span>) y temperatura (<span class="math inline">\(T\)</span>) en base a fundamentos teóricos del comportamiento molecular de los compuestos. En otras palabras, <strong>las <em>EoS</em> explican el comportamiento macroscópico de los fluidos a partir de lo microscópico</strong>. Entender en profundidad cada ecuación de estado no es la finalidad de este curso. Lo más importante es que entiendan los motivos por los cuales se utilizan y, también, que formen una idea general de los términos que aparecen en ellas.</p>
<section id="términos-asociados-a-los-principios-de-lennard-jones" class="level3">
<h3 class="anchored" data-anchor-id="términos-asociados-a-los-principios-de-lennard-jones">Términos asociados a los principios de Lennard-Jones</h3>
<div>

</div>
<div class="quarto-layout-panel" data-layout="[0.65, 0.35]">
<div class="quarto-layout-row">
<div id="firstcol" class="quarto-layout-cell" style="flex-basis: 65.0%;justify-content: flex-start;">
<p><br>
El potencial de Lennard-Jones es un modelo de interacción molecular que describe el comportamiento de atracción y repulsión entre dos moléculas. <span class="math display">\[
\Gamma = 4\varepsilon\left[\left(\frac{\sigma}{r}\right)^{12}-\left(\frac{\sigma}{r}\right)^{6}\right]
\]</span> A nosotros solo nos interesa saber que algunos modelos termodinámicos se basan en los principios propuestos por este modelo para mejorar su capacidad de predicción.</p>
</div>
<div id="secondcol" class="quarto-layout-cell" style="flex-basis: 35.0%;justify-content: flex-start;">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Parámetros y variables
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><span class="math inline">\(\Gamma\)</span>: Energía potencial intermolecular.</li>
<li><span class="math inline">\(r\)</span>: Distancia entre las dos moléculas.</li>
<li><span class="math inline">\(\sigma\)</span>: Distancia a la cual las moléculas pasan de atraerse (<span class="math inline">\(\Gamma&lt;0\)</span>) a repelerse (<span class="math inline">\(\Gamma&gt;0\)</span>).</li>
<li><span class="math inline">\(\varepsilon\)</span>: Energía potencial máxima de atracción.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<ul>
<li><strong>Término atractivo (<span class="math inline">\(a\)</span>)</strong>: En las <em>EoS</em> tipo Van der Waals se incluye este término para representar la <strong>atracción entre las moléculas</strong>. Lennard-Jones propone que esta interacción es dependiente de la polaridad de las moléculas y de la distancia entre ellas.</li>
<li><strong>Término de exclusión por volumen (<span class="math inline">\(b\)</span>)</strong>: Este parámetro representa el volumen que no puede ocupar un molécula a causa de que otra se encuentre en dicho espacio. Es lógico pensar que este fenómeno ocurre; una molécula no puede ocupar un espacio que otra ya está ocupando. En términos de Lennard-Jones: a medida que una molécula se acerca a otra, la energía potencial repulsiva entre ellas tiende a infinito por lo que nunca se tocan. Por eso, este parámetro se conoce como el <strong>término repulsivo</strong>.</li>
</ul>
</section>
<section id="otros-términos" class="level3">
<h3 class="anchored" data-anchor-id="otros-términos">Otros términos</h3>
<p>Podemos seguir mejorando los modelos eliminando otros supuestos. Uno de ellos es que las moléculas son perfectamente esféricas. Esto es relativamente cierto para moléculas pequeñas, pero limita la aplicabilidad del modelo. Para arreglar este problema se utiliza el <strong>factor acéntrico (<span class="math inline">\(\omega\)</span>)</strong>. En otras palabras, este parámetro representa la no esfercidad de las moléculas.</p>
<p>Otro aspecto que no estamos considerando es el efecto de la temperatura. La temperatura impacta directamente la forma en que las moléculas interactuan y se atraen, por lo que podemos definir <strong>la atracción/interacción como una función de T, tal que <span class="math inline">\(a(T)\)</span></strong>. La ecuación de Peng-Robinson es un ejemplo de la aplicación de esta variación (entiéndase <span class="math inline">\(\alpha(T)\)</span> como una expansión del término de <span class="math inline">\(a\)</span>).</p>
<p><br></p>
</section>
</section>
<section id="ejemplo-diagrama-pv-para-co_2" class="level2">
<h2 class="anchored" data-anchor-id="ejemplo-diagrama-pv-para-co_2">Ejemplo: Diagrama PV para CO<span class="math inline">\(_2\)</span></h2>
<p>Pongamos a prueba la teoría con una modelación. Suponga que desea predecir la relación PVT para dióxido de carbono. Para esto usted usará dos ecuaciones de estado: <strong>Van der Waals</strong> y <strong>Peng-Robinson</strong>. La validación experimental se hará en base a la <strong>curva de saturación</strong> real de CO<span class="math inline">\(_2\)</span> (NIST). Las ecuaciones de estos modelos son las siguientes:</p>
<p><span id="eq-vdw"><span class="math display">\[
\text{Van der Waals:}~~~P = \frac{RT}{\underline{V}-b}-\frac{a}{\underline{V}^2}
\tag{1}\]</span></span></p>
<p><span class="math display">\[
\text{donde,}~~a = \frac{27}{64}\frac{(RT_c)^2}{P_c}~;~~ b = \frac{1}{8}\frac{RT_c}{P_c}
\]</span></p>
<p><span id="eq-pr"><span class="math display">\[
\text{Peng-Robinson:}~~~P = \frac{RT}{\underline{V}-b}-\frac{a\alpha(T)}{\underline{V}^2+2b\underline{V}-b^2}
\tag{2}\]</span></span></p>
<p><span class="math display">\[
\text{donde,}~~a = 0.45724\frac{(RT_c)^2}{P_c}~;~~ b = 0.0778\frac{RT_c}{P_c}
\]</span> <span class="math display">\[
\alpha(T)=\left(1+\left(0.37464 + 1.54226\omega − 0.26992\omega^2\right)\times\left(1-T_r^{0.5}\right)\right)^2
\]</span> Notar que Peng-Robinson considera tanto los parámetros <span class="math inline">\(a\)</span> y <span class="math inline">\(b\)</span>, como los parámetros <span class="math inline">\(\omega\)</span> y la dependencia de temperatura para el término de interacción. A continuación un gráfico comparativo entre ambas <em>EoS</em>.</p>
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| viewerHeight: 550

from shiny import *
import numpy as np
from scipy.optimize import fsolve
import matplotlib.pyplot as plt

AnimationOptions = {'interval': 200,'loop': False}

app_ui = ui.page_sidebar(
  ui.sidebar(
    "Ecuaciones de estado:",
    ui.input_switch("switch_vdw","Van der Waals", value=True),
    ui.input_switch("switch_pr","Peng-Robinson", value=True),
    ui.input_slider("T","Isolínea de Temperatura:", min=285,max=315,value=289,step=3,animate=AnimationOptions,post=" K"),
    width=300),
  ui.output_plot("plot")
)


def server(input, output, session):
  
  # Propiedades termodinámicas CO2 TODAS DE NIST DATABASE (Suehiro, Nakajima, et al., 1996)
  Tc = 304.18 #K
  Pc = 73.80e5 #Pa
  omega = 0.239
  V = np.linspace(50e-6, 380e-6, 330) #m3/mol
  R = 8.314

  ######################## SAT (NIST) ########################
  Psat_exp = [4, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9, 5, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8, 5.9, 6, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.9, 7, 7.1, 7.2, 7.3, 7.314, 7.328, 7.342, 7.356, 7.37, 7.38, 7.37, 7.356, 7.342, 7.328, 7.314, 7.3, 7.2, 7.1, 7, 6.9, 6.8, 6.7, 6.6, 6.5, 6.4, 6.3, 6.2, 6.1, 6, 5.9, 5.8, 5.7, 5.6, 5.5, 5.4, 5.3, 5.2, 5.1, 5, 4.9, 4.8, 4.7, 4.6, 4.5, 4.4, 4.3, 4.2, 4.1, 4]
  vsat_exp = [49.225, 49.586, 49.953, 50.327, 50.709, 51.099, 51.498, 51.906, 52.324, 52.754, 53.196, 53.651, 54.12, 54.605, 55.108, 55.629, 56.171, 56.736, 57.327, 57.947, 58.599, 59.288, 60.019, 60.8, 61.639, 62.548, 63.541, 64.64, 65.873, 67.285, 68.948, 70.993, 73.717, 78.051, 78.96, 80.025, 81.328, 83.06, 85.936, 91.9, 103.51, 108.16, 111.28, 113.81, 115.99, 117.95, 128.82, 137.29, 144.75, 151.68, 158.28, 164.69, 170.98, 177.22, 183.44, 189.67, 195.94, 202.28, 208.69, 215.21, 221.84, 228.6, 235.5, 242.57, 249.82, 257.26, 264.91, 272.78, 280.9, 289.28, 297.94, 306.91, 316.2, 325.84, 335.85, 346.26, 357.11, 368.43, 380.24]
  ################# v (cm3/mol) // p (MPa) ###################

  ## VAN DER WAALS
  @reactive.calc
  def vdw_eos():
    T = input.T()
    a = 27/64 * (R*Tc)**2/Pc
    b = 1/8 * (R*Tc)/Pc
    P = []
    for v in V:
      p = (R*T)/(v-b) - a/v**2
      P.append(p/10**6)
    
    return V*10**6, P
  
  @reactive.calc
  def vdw_isofug():
    T = input.T()
    a = 27/64 * (R*Tc)**2/Pc
    b = 1/8 * (R*Tc)/Pc
    v0 =[80e-6, 230e-6, 5.3e6] # Esto funciona, simplemente con prueba y error entre los límites (280K - &lt;Tc)

    def solver_vdw(I):
      vL, vV, Psat = I
      zL = (Psat*vL)/(R*T)
      zV = (Psat*vV)/(R*T)
      phiL = np.exp(zL - 1 - a/(R*T*vL) - np.log(zL*(1 - b/vL)))
      phiV = np.exp(zV - 1 - a/(R*T*vV) - np.log(zV*(1 - b/vV)))
      pL = (R*T)/(vL-b) - a/vL**2
      pV = (R*T)/(vV-b) - a/vV**2

      f1 = phiL - phiV
      f2 = pL - Psat
      f3 = pV - Psat
      return [f1,f2,f3]
    
    vdw_sol = fsolve(solver_vdw, v0)
    return vdw_sol
  
  ## PENG-ROBINSON
  @reactive.calc
  def pr_eos():
    T = input.T()
    a = 0.45724 * (R*Tc)**2/Pc
    alpha = (1 + (0.37464 + 1.54226*omega - 0.26992*omega**2)*(1-(T/Tc)**(1/2)))**2
    b = 0.0778 * (R*Tc)/Pc
    P = []
    for v in V:
      p = (R*T)/(v-b) - (a*alpha)/(v**2+2*b*v-b**2)
      P.append(p/10**6)
    
    return V*10**6, P
  
  @reactive.calc
  def pr_isofug():
    T = input.T()
    a = 0.45724 * (R*Tc)**2/Pc
    alpha = (1 + (0.37464 + 1.54226*omega - 0.26992*omega**2)*(1-(T/Tc)**(1/2)))**2
    b = 0.0778 * (R*Tc)/Pc

    v0 =[60e-6, 190e-6, 5.3e6] # Esto funciona, simplemente con prueba y error entre los límites (280K - &lt;Tc)

    def solver_pr(I):
      vL, vV, Psat = I
      A = (a*alpha*Psat)/(R*T)**2
      B = (b*Psat)/(R*T)
      zL = (Psat*vL)/(R*T)
      zV = (Psat*vV)/(R*T)

      phiL = np.exp(zL - 1 - np.log(zL - B) - A/(B*8**(1/2))*np.log((zL+(1+2**(1/2))*B)/(zL+(1-2**(1/2))*B)))
      phiV = np.exp(zV - 1 - np.log(zV - B) - A/(B*8**(1/2))*np.log((zV+(1+2**(1/2))*B)/(zV+(1-2**(1/2))*B)))
      pL = (R*T)/(vL-b) - (a*alpha)/(vL**2+2*b*vL-b**2)
      pV = (R*T)/(vV-b) - (a*alpha)/(vV**2+2*b*vV-b**2)

      f1 = phiL - phiV
      f2 = pL - Psat
      f3 = pV - Psat
      return [f1,f2,f3]
    
    pr_sol = fsolve(solver_pr, v0)
    return pr_sol

  # Graficar

  @render.plot(width=550,height=500)
  def plot():

    if input.switch_vdw():
      v_vdw, P_vdw = vdw_eos() # retorna en cm3/mol y MPa
      plt.plot(v_vdw, P_vdw, c="#7e9da2", label="Van der Waals")
      
      if input.T() &lt; Tc:
        vL_vdw, vV_vdw, Psat_vdw = vdw_isofug() # retorna en m3/mol y Pa
        plt.plot([vL_vdw*10**6,vV_vdw*10**6], [Psat_vdw*10**(-6),Psat_vdw*10**(-6)], c="#7e9da2", linestyle='dashed')

    if input.switch_pr():
      v_pr, P_pr = pr_eos() # retorna en cm3/mol y MPa
      plt.plot(v_pr, P_pr, c="#cc3739", label="Peng-Robinson")
      
      if input.T() &lt; Tc:
        vL_pr, vV_pr, Psat_pr = pr_isofug() # retorna en m3/mol y Pa
        plt.plot([vL_pr*10**6,vV_pr*10**6], [Psat_pr*10**(-6),Psat_pr*10**(-6)], c="#cc3739", linestyle='dashed')
      

    plt.plot(vsat_exp, Psat_exp, c="#0e150d", label="Curva de saturación")
    plt.legend()
    plt.xlabel("Volumen molar / cm$^3\cdot$mol$^{-1}$")
    plt.ylabel("Presión / MPa")
    plt.xlim([50,380])
    plt.ylim([4,10])
    plt.show()

app = App(app_ui, server)
</code></pre>
<p>En la figura, las líneas continuas representan las ecuaciones <a href="#eq-vdw" class="quarto-xref">1</a> y <a href="#eq-pr" class="quarto-xref">2</a>. Es importante notar que bajo la curva de saturación, ambas EoS presentan un comportamiento que no sigue el patrón esperado. Usualmente, aprendemos que, a presión constante, la temperatura permanece estable hasta que ocurre el cambio de fase, o que, a temperatura constante (como en el gráfico), la presión se mantiene fija hasta que el cambio de fase tiene lugar. Sin embargo, estas ecuaciones de estado no parecen cumplir con esta observación.</p>
<p>Para definir correctamente el cambio de fase, necesitamos recurrir a la <strong>energía libre de Gibbs</strong> o, de manera equivalente, a la <strong>fugacidad</strong>. La fugacidad en el gráfico está representada por la línea discontinua y su predicción depende de la ecuación de estado utilizada. El objetivo de esta sección no es explicar la fugacidad. De momento, es preferible analizar el gráfico y responder las siguientes preguntas.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Preguntas
</div>
</div>
<div class="callout-body-container callout-body">
<p>¿Qué modelo predice mejor la curva de saturación? ¿Existen diferencias entre las presiones de saturación entre los modelos? ¿Qué puede decir sobre las predicciones en fase gaseosa? ¿Y en fase líquida?</p>
</div>
</div>
<p><br></p>
<p>hola</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/IIQ2043\.github\.io\/workbook\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/IIQ2043/workbook/blob/main/mc_eos.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div></div></footer></body></html>